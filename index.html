<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Generator Image dan Video</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #555; }
        .loader {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Helper Components ---
        const HelpIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
            </svg>
        );
        const AspectRatioIcon = ({ type }) => {
            if (type === 'portrait') return <svg viewBox="0 0 10 16" className="w-3 h-4 mr-2"><rect width="10" height="16" rx="1" fill="currentColor"/></svg>;
            if (type === 'landscape') return <svg viewBox="0 0 16 10" className="w-4 h-3 mr-2"><rect width="16" height="10" rx="1" fill="currentColor"/></svg>;
            return <svg viewBox="0 0 12 12" className="w-3 h-3 mr-2"><rect width="12" height="12" rx="1" fill="currentColor"/></svg>;
        };

        // --- Main Application Component ---
        const App = () => {
            // --- State Management ---
            const [mainCategory, setMainCategory] = useState('promosi');
            const [apiKey, setApiKey] = useState('');
            const [outputType, setOutputType] = useState('image');
            const [activeTab, setActiveTab] = useState('id');
            const [history, setHistory] = useState([]);
            const [view, setView] = useState('form');

            // Loading & Results
            const [isLoading, setIsLoading] = useState(false);
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [isGeneratingImage, setIsGeneratingImage] = useState(false);
            const [generatedPromptId, setGeneratedPromptId] = useState('');
            const [generatedPromptEn, setGeneratedPromptEn] = useState('');
            const [previewImageUrl, setPreviewImageUrl] = useState('');
            const [copySuccess, setCopySuccess] = useState('');

            // Modals
            const [isHelpModalOpen, setIsHelpModalOpen] = useState(false);

            // Form Inputs
            const [inputs, setInputs] = useState({
                // Shared
                toneOfVoice: 'Profesional', customToneOfVoice: '',
                visualStyle: 'Modern & Minimalis', customVisualStyle: '',
                aspectRatio: '4:5',
                // Promosi
                productName: '', targetAudience: 'Profesional Muda (25-35 tahun)', keyMessage: '', promoType: 'Diskon Spesial', ctaText: 'Beli Sekarang!',
                // Ucapan
                greetingType: 'Ulang Tahun', customGreetingType: '', recipientName: 'Sahabatku', greetingMessage: 'Semoga panjang umur dan sehat selalu!',
                // Konten Sosmed
                socialTopic: 'Tips fotografi mobile', socialPlatform: 'Instagram Post', socialGoal: 'Edukasi',
                // Packaging
                packagingProduct: 'Keripik Kentang', packagingType: 'Pouch', materialTexture: 'Plastik Matte', requiredInfo: 'Logo, Nama Brand, Varian Rasa, Netto', graphicElements: 'Ilustrasi kentang dan cabai',
                // Food Photography
                foodName: 'Nasi Goreng Seafood', platingStyle: 'Minimalis di piring putih', foodElements: 'Taburan daun bawang dan kerupuk', foodLighting: 'Cahaya sore dari jendela', foodBackground: 'Meja marmer putih',
                // Real Estate
                buildingType: 'Vila mewah modern', architectureStyle: 'Japandi', timeAndWeather: 'Pagi hari yang cerah', cameraAngle: 'Eye-level dari depan', mainFeature: 'Kolam renang infinity pool',
                // Character
                characterSubject: 'Robot asisten yang ramah', artStyle: 'Gaya kartun Disney 3D', poseAndExpression: 'Tersenyum dan melambai', clothingAndAccessories: 'Mengenakan celemek dan dasi kupu-kupu', characterBackground: 'Polos dengan warna gradien',
                // Video
                videoDuration: '15 detik', musicMood: 'Ceria dan bersemangat', characterName: 'Bara', characterDesc: 'Seorang barista muda yang ramah', characterDialog: 'Pagi jadi lebih semangat!'
            });
            
            // --- Effects ---
            useEffect(() => {
                const savedHistory = localStorage.getItem('promptHistory');
                if (savedHistory) setHistory(JSON.parse(savedHistory));
            }, []);

            // --- Handlers ---
            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setInputs(prev => ({ ...prev, [name]: value }));
            };

            // --- File & History ---
            const copyToClipboard = (text) => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.top = "-9999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopySuccess('Prompt berhasil disalin!');
                } catch (err) {
                    setCopySuccess('Gagal menyalin prompt.');
                }
                document.body.removeChild(textArea);
                setTimeout(() => setCopySuccess(''), 2000);
            };

            const saveToFile = (text) => {
                const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `prompt-${Date.now()}.txt`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            };

            const saveToHistory = (idPrompt, enPrompt) => {
                const newHistoryItem = { id: Date.now(), inputs: { ...inputs }, promptId: idPrompt, promptEn: enPrompt, isFavorite: false, outputType: outputType, mainCategory: mainCategory };
                const updatedHistory = [newHistoryItem, ...history];
                setHistory(updatedHistory);
                localStorage.setItem('promptHistory', JSON.stringify(updatedHistory));
            };
            
            const loadFromHistory = (item) => {
                setInputs(item.inputs);
                setGeneratedPromptId(item.promptId);
                setGeneratedPromptEn(item.promptEn);
                setOutputType(item.outputType);
                setMainCategory(item.mainCategory);
                setPreviewImageUrl('');
                setView('form');
            };
            
            const toggleFavorite = (id) => {
                const updatedHistory = history.map(item => item.id === id ? { ...item, isFavorite: !item.isFavorite } : item);
                setHistory(updatedHistory);
                localStorage.setItem('promptHistory', JSON.stringify(updatedHistory));
            };

            // --- AI API Calls ---
            const callApi = async (prompt) => {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                if (!response.ok) throw new Error(`Google AI Error: ${response.statusText}`);
                const data = await response.json();
                if (!data.candidates || !data.candidates[0].content.parts[0].text) throw new Error('Invalid response from API.');
                return data.candidates[0].content.parts[0].text;
            };

            const buildBasePrompt = () => {
                const finalToneOfVoice = inputs.toneOfVoice === 'Lainnya...' ? inputs.customToneOfVoice : inputs.toneOfVoice;
                const finalVisualStyle = inputs.visualStyle === 'Lainnya...' ? inputs.customVisualStyle : inputs.visualStyle;
                const finalGreetingType = inputs.greetingType === 'Lainnya...' ? inputs.customGreetingType : inputs.greetingType;
                
                let details = `
                    - Nada Suara: ${finalToneOfVoice}
                    - Gaya Visual: ${finalVisualStyle}`;

                if (outputType === 'image') {
                    details += `\n- Aspek Rasio: ${inputs.aspectRatio}`;
                } else {
                    details += `
                    - Durasi: ${inputs.videoDuration}
                    - Suasana/Musik: ${inputs.musicMood}
                    - Karakter: ${inputs.characterName} (${inputs.characterDesc})
                    - Dialog: "${inputs.characterDialog}"`;
                }

                switch (mainCategory) {
                    case 'promosi':
                        details += `\n- Kategori: Promosi Produk\n- Produk: ${inputs.productName}\n- Target: ${inputs.targetAudience}\n- Pesan: ${inputs.keyMessage}\n- CTA: ${inputs.ctaText}\n- Promo: ${inputs.promoType}`;
                        break;
                    case 'ucapan':
                        details += `\n- Kategori: Kartu Ucapan\n- Jenis Ucapan: ${finalGreetingType}\n- Untuk: ${inputs.recipientName}\n- Pesan: ${inputs.greetingMessage}`;
                        break;
                    case 'sosmed':
                        details += `\n- Kategori: Konten Sosial Media\n- Topik: ${inputs.socialTopic}\n- Platform: ${inputs.socialPlatform}\n- Tujuan: ${inputs.socialGoal}`;
                        break;
                    case 'packaging':
                        details += `\n- Kategori: Desain Packaging\n- Produk: ${inputs.packagingProduct}\n- Jenis Packaging: ${inputs.packagingType}\n- Material & Tekstur: ${inputs.materialTexture}\n- Info Wajib: ${inputs.requiredInfo}\n- Unsur Grafis: ${inputs.graphicElements}`;
                        break;
                    case 'makanan':
                        details += `\n- Kategori: Fotografi Makanan\n- Nama Makanan: ${inputs.foodName}\n- Gaya Plating: ${inputs.platingStyle}\n- Elemen Tambahan: ${inputs.foodElements}\n- Pencahayaan: ${inputs.foodLighting}\n- Latar Belakang: ${inputs.foodBackground}`;
                        break;
                    case 'properti':
                        details += `\n- Kategori: Properti & Arsitektur\n- Tipe Bangunan: ${inputs.buildingType}\n- Gaya Arsitektur: ${inputs.architectureStyle}\n- Waktu & Cuaca: ${inputs.timeAndWeather}\n- Sudut Kamera: ${inputs.cameraAngle}\n- Fitur Utama: ${inputs.mainFeature}`;
                        break;
                    case 'karakter':
                        details += `\n- Kategori: Desain Karakter\n- Subjek: ${inputs.characterSubject}\n- Gaya Seni: ${inputs.artStyle}\n- Pose & Ekspresi: ${inputs.poseAndExpression}\n- Pakaian & Aksesori: ${inputs.clothingAndAccessories}\n- Latar Belakang: ${inputs.characterBackground}`;
                        break;
                }
                
                const promptType = outputType === 'image' ? 'AI Image Generator (Midjourney/DALL-E)' : 'AI Video Generator (Google Veo)';
                return `Buatkan prompt detail untuk ${promptType} berdasarkan:\n${details}\nStruktur prompt harus profesional. Untuk gambar, sertakan komposisi dan pencahayaan. Untuk video, buat seperti skenario film. Tulis "aspek rasio" secara lengkap.`;
            };

            const generatePrompt = async () => {
                if (!apiKey) {
                    alert('Silakan masukkan API Key Anda.');
                    return;
                }
                setIsLoading(true);
                setGeneratedPromptId(''); setGeneratedPromptEn(''); setPreviewImageUrl(''); setActiveTab('id');

                const basePrompt = buildBasePrompt();

                try {
                    const idPrompt = await callApi(`Anda adalah ahli prompt engineering. ${basePrompt} Buat dalam Bahasa Indonesia.`);
                    setGeneratedPromptId(idPrompt);
                    const enPrompt = await callApi(`You are an expert prompt engineer. ${basePrompt.replace('Buat dalam Bahasa Indonesia.', 'Create the prompt in English.')}`);
                    setGeneratedPromptEn(enPrompt);
                    saveToHistory(idPrompt, enPrompt);
                } catch (error) {
                    alert(`Gagal membuat prompt. Error: ${error.message}`);
                } finally {
                    setIsLoading(false);
                }
            };
            
            const generateImagePreview = async () => {
                if (!apiKey || !generatedPromptEn) {
                    alert('Prompt harus dibuat terlebih dahulu.');
                    return;
                }
                setIsGeneratingImage(true);
                setPreviewImageUrl('');
                try {
                    const payload = { instances: [{ prompt: generatedPromptEn }], parameters: { sampleCount: 1 } };
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    if (result.predictions && result.predictions[0].bytesBase64Encoded) {
                        setPreviewImageUrl(`data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`);
                    } else {
                        throw new Error('No image data in API response.');
                    }
                } catch (error) {
                    alert(`Gagal membuat pratinjau gambar. Error: ${error.message}`);
                } finally {
                    setIsGeneratingImage(false);
                }
            };

            // --- Render ---
            return (
                <div className="min-h-screen bg-gray-100 p-4 sm:p-8">
                    <div className="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {/* --- LEFT PANEL --- */}
                        <div className="bg-white p-6 rounded-xl shadow-lg flex flex-col">
                            <div className="flex justify-between items-center mb-2">
                                <h1 className="text-3xl font-bold text-gray-800">Prompt Generator Powered by Ai</h1>
                                <button onClick={() => setView(view === 'form' ? 'history' : 'form')} className="text-sm font-medium text-blue-600 hover:text-blue-800">
                                    {view === 'form' ? 'Lihat Riwayat' : 'Kembali ke Form'}
                                </button>
                            </div>
                             <p className="text-gray-500 mb-6">Cara Mudah Jadi Kreatif dan Pintar Membuat Prompt Menggunakan Ai</p>
                            
                            {view === 'form' ? (
                                <>
                                <div className="space-y-4 overflow-y-auto custom-scrollbar pr-2 flex-grow">
                                    {/* --- Section 1: AI Settings --- */}
                                    <div className="p-4 border rounded-lg">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">Pengaturan AI</h3>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">API Key (Google AI Studio)</label>
                                        <div className="flex items-center space-x-2">
                                            <input type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} placeholder="Masukkan API Key Anda" className="w-full px-3 py-2 border rounded-md" />
                                            <button onClick={() => setIsHelpModalOpen(true)} className="text-gray-500 shrink-0"><HelpIcon /></button>
                                        </div>
                                    </div>
                                    
                                    {/* --- Section 2: Main Category --- */}
                                    <div className="p-4 border rounded-lg">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">1. Pilih Kategori Prompt</h3>
                                        <select value={mainCategory} onChange={(e) => setMainCategory(e.target.value)} className="w-full p-2 border rounded-md">
                                            <option value="promosi">Promosi Produk</option>
                                            <option value="packaging">Desain Packaging</option>
                                            <option value="ucapan">Kartu Ucapan</option>
                                            <option value="sosmed">Konten Sosial Media</option>
                                            <option value="makanan">Fotografi Makanan</option>
                                            <option value="properti">Properti & Arsitektur</option>
                                            <option value="karakter">Desain Karakter</option>
                                        </select>
                                    </div>
                                    
                                    {/* --- Section 3: Input Details (Conditional) --- */}
                                    <div className="p-4 border rounded-lg">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">2. Isi Detail</h3>
                                        { mainCategory === 'promosi' && (
                                            <div className="space-y-4">
                                                <input name="productName" value={inputs.productName} onChange={handleInputChange} placeholder="Nama Produk" className="w-full p-2 border rounded-md" />
                                                <input name="targetAudience" value={inputs.targetAudience} onChange={handleInputChange} placeholder="Target Audiens" className="w-full p-2 border rounded-md" />
                                                <input name="keyMessage" value={inputs.keyMessage} onChange={handleInputChange} placeholder="Pesan/Keunggulan Utama" className="w-full p-2 border rounded-md" />
                                                <input name="ctaText" value={inputs.ctaText} onChange={handleInputChange} placeholder="Teks Call to Action (CTA)" className="w-full p-2 border rounded-md" />
                                            </div>
                                        )}
                                        { mainCategory === 'packaging' && (
                                            <div className="space-y-4">
                                                <input name="packagingProduct" value={inputs.packagingProduct} onChange={handleInputChange} placeholder="Nama Produk" className="w-full p-2 border rounded-md" />
                                                <select name="packagingType" value={inputs.packagingType} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                                    <option>Kotak</option><option>Pouch (Kantong)</option><option>Botol</option><option>Kaleng</option><option>Tube</option>
                                                </select>
                                                <input name="materialTexture" value={inputs.materialTexture} onChange={handleInputChange} placeholder="Material & Tekstur (cth: Karton Doff)" className="w-full p-2 border rounded-md" />
                                                <textarea name="requiredInfo" value={inputs.requiredInfo} onChange={handleInputChange} placeholder="Informasi Wajib (Logo, Netto, dll)" className="w-full p-2 border rounded-md" rows="2"></textarea>
                                                <textarea name="graphicElements" value={inputs.graphicElements} onChange={handleInputChange} placeholder="Unsur Grafis (Ilustrasi, Pola, dll)" className="w-full p-2 border rounded-md" rows="2"></textarea>
                                            </div>
                                        )}
                                        { mainCategory === 'ucapan' && (
                                            <div className="space-y-4">
                                                <select name="greetingType" value={inputs.greetingType} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                                    <option>Ulang Tahun</option><option>Idul Fitri</option><option>Tahun Baru</option><option>Hari Kemerdekaan</option><option value="Lainnya...">Lainnya...</option>
                                                </select>
                                                {inputs.greetingType === 'Lainnya...' && <input name="customGreetingType" value={inputs.customGreetingType} onChange={handleInputChange} placeholder="Ketik Jenis Ucapan Anda" className="w-full p-2 border rounded-md" />}
                                                <input name="recipientName" value={inputs.recipientName} onChange={handleInputChange} placeholder="Nama Penerima" className="w-full p-2 border rounded-md" />
                                                <textarea name="greetingMessage" value={inputs.greetingMessage} onChange={handleInputChange} placeholder="Pesan Ucapan" className="w-full p-2 border rounded-md" rows="3"></textarea>
                                            </div>
                                        )}
                                        { mainCategory === 'sosmed' && (
                                            <div className="space-y-4">
                                                <input name="socialTopic" value={inputs.socialTopic} onChange={handleInputChange} placeholder="Topik Konten" className="w-full p-2 border rounded-md" />
                                                <select name="socialPlatform" value={inputs.socialPlatform} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                                    <option>Instagram Post</option><option>Instagram Story</option><option>TikTok</option><option>YouTube Short</option><option>Twitter (X)</option>
                                                </select>
                                                <select name="socialGoal" value={inputs.socialGoal} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                                    <option>Edukasi</option><option>Hiburan</option><option>Inspirasi</option><option>Interaksi (Engagement)</option>
                                                </select>
                                            </div>
                                        )}
                                        { mainCategory === 'makanan' && (
                                            <div className="space-y-4">
                                                <input name="foodName" value={inputs.foodName} onChange={handleInputChange} placeholder="Nama Makanan" className="w-full p-2 border rounded-md" />
                                                <input name="platingStyle" value={inputs.platingStyle} onChange={handleInputChange} placeholder="Gaya Plating" className="w-full p-2 border rounded-md" />
                                                <input name="foodElements" value={inputs.foodElements} onChange={handleInputChange} placeholder="Elemen Tambahan" className="w-full p-2 border rounded-md" />
                                                <input name="foodLighting" value={inputs.foodLighting} onChange={handleInputChange} placeholder="Pencahayaan" className="w-full p-2 border rounded-md" />
                                                <input name="foodBackground" value={inputs.foodBackground} onChange={handleInputChange} placeholder="Latar Belakang" className="w-full p-2 border rounded-md" />
                                            </div>
                                        )}
                                        { mainCategory === 'properti' && (
                                            <div className="space-y-4">
                                                <input name="buildingType" value={inputs.buildingType} onChange={handleInputChange} placeholder="Tipe Bangunan" className="w-full p-2 border rounded-md" />
                                                <input name="architectureStyle" value={inputs.architectureStyle} onChange={handleInputChange} placeholder="Gaya Arsitektur" className="w-full p-2 border rounded-md" />
                                                <input name="timeAndWeather" value={inputs.timeAndWeather} onChange={handleInputChange} placeholder="Waktu & Cuaca" className="w-full p-2 border rounded-md" />
                                                <input name="cameraAngle" value={inputs.cameraAngle} onChange={handleInputChange} placeholder="Sudut Kamera" className="w-full p-2 border rounded-md" />
                                                <input name="mainFeature" value={inputs.mainFeature} onChange={handleInputChange} placeholder="Fitur Utama" className="w-full p-2 border rounded-md" />
                                            </div>
                                        )}
                                        { mainCategory === 'karakter' && (
                                            <div className="space-y-4">
                                                <input name="characterSubject" value={inputs.characterSubject} onChange={handleInputChange} placeholder="Subjek Karakter" className="w-full p-2 border rounded-md" />
                                                <input name="artStyle" value={inputs.artStyle} onChange={handleInputChange} placeholder="Gaya Seni" className="w-full p-2 border rounded-md" />
                                                <input name="poseAndExpression" value={inputs.poseAndExpression} onChange={handleInputChange} placeholder="Pose & Ekspresi" className="w-full p-2 border rounded-md" />
                                                <input name="clothingAndAccessories" value={inputs.clothingAndAccessories} onChange={handleInputChange} placeholder="Pakaian & Aksesori" className="w-full p-2 border rounded-md" />
                                                <input name="characterBackground" value={inputs.characterBackground} onChange={handleInputChange} placeholder="Latar Belakang" className="w-full p-2 border rounded-md" />
                                            </div>
                                        )}
                                    </div>
                                    
                                    {/* --- Section 4: General Settings --- */}
                                    <div className="p-4 border rounded-lg">
                                        <h3 className="text-lg font-semibold text-gray-700 mb-3">3. Pengaturan Umum</h3>
                                        <div className="space-y-4">
                                            <div className="flex rounded-lg bg-gray-200 p-1">
                                                <button onClick={() => setOutputType('image')} className={`w-full py-2 rounded-md text-sm font-semibold ${outputType === 'image' ? 'bg-white text-blue-600 shadow' : 'bg-transparent text-gray-600'}`}>Gambar/Foto</button>
                                                <button onClick={() => setOutputType('video')} className={`w-full py-2 rounded-md text-sm font-semibold ${outputType === 'video' ? 'bg-white text-blue-600 shadow' : 'bg-transparent text-gray-600'}`}>Video</button>
                                            </div>
                                            <select name="toneOfVoice" value={inputs.toneOfVoice} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                                <option>Profesional</option><option>Humoris</option><option>Inspiratif</option><option>Mendesak (Urgent)</option><option>Ramah</option><option>Mewah</option><option value="Lainnya...">Lainnya...</option>
                                            </select>
                                            {inputs.toneOfVoice === 'Lainnya...' && <input name="customToneOfVoice" value={inputs.customToneOfVoice} onChange={handleInputChange} placeholder="Ketik Nada Suara Anda" className="w-full p-2 border rounded-md" />}
                                            
                                            <select name="visualStyle" value={inputs.visualStyle} onChange={handleInputChange} className="w-full p-2 border rounded-md">
                                                <option>Modern & Minimalis</option><option>Elegan & Mewah</option><option>Ceria & Penuh Warna</option><option>Vintage & Retro</option><option>Futuristik & Teknologi</option><option>Dinamis & Teknologi</option><option value="Lainnya...">Lainnya...</option>
                                            </select>
                                            {inputs.visualStyle === 'Lainnya...' && <input name="customVisualStyle" value={inputs.customVisualStyle} onChange={handleInputChange} placeholder="Ketik Gaya Visual Anda" className="w-full p-2 border rounded-md" />}
                                        </div>
                                    </div>

                                    {/* --- Section 5: Specific Settings --- */}
                                    {outputType === 'image' ? (
                                        <div className="p-4 border rounded-lg">
                                            <h3 className="text-lg font-semibold text-gray-700 mb-3">4. Pengaturan Gambar</h3>
                                            <div className="grid grid-cols-2 gap-2">
                                                <button onClick={() => setInputs(p => ({...p, aspectRatio: '4:5'}))} className={`flex items-center justify-center p-2 rounded-md ${inputs.aspectRatio === '4:5' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}><AspectRatioIcon type="portrait" /> 4:5</button>
                                                <button onClick={() => setInputs(p => ({...p, aspectRatio: '9:16'}))} className={`flex items-center justify-center p-2 rounded-md ${inputs.aspectRatio === '9:16' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}><AspectRatioIcon type="portrait" /> 9:16</button>
                                                <button onClick={() => setInputs(p => ({...p, aspectRatio: '1:1'}))} className={`flex items-center justify-center p-2 rounded-md ${inputs.aspectRatio === '1:1' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}><AspectRatioIcon type="square" /> 1:1</button>
                                                <button onClick={() => setInputs(p => ({...p, aspectRatio: '16:9'}))} className={`flex items-center justify-center p-2 rounded-md ${inputs.aspectRatio === '16:9' ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}><AspectRatioIcon type="landscape" /> 16:9</button>
                                            </div>
                                            <input name="aspectRatio" value={inputs.aspectRatio} onChange={handleInputChange} placeholder="Atau ketik rasio kustom (misal: 3:2)" className="w-full p-2 border rounded-md mt-3" />
                                        </div>
                                    ) : (
                                        <div className="p-4 border rounded-lg">
                                            <h3 className="text-lg font-semibold text-gray-700 mb-3">4. Pengaturan Video</h3>
                                            <div className="space-y-4">
                                                <input name="characterName" value={inputs.characterName} onChange={handleInputChange} placeholder="Nama Karakter" className="w-full p-2 border rounded-md" />
                                                <input name="characterDesc" value={inputs.characterDesc} onChange={handleInputChange} placeholder="Deskripsi Karakter" className="w-full p-2 border rounded-md" />
                                                <textarea name="characterDialog" value={inputs.characterDialog} onChange={handleInputChange} rows="3" placeholder="Dialog Karakter" className="w-full p-2 border rounded-md"></textarea>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                <button onClick={generatePrompt} disabled={isLoading} className="mt-8 w-full py-3 bg-blue-600 text-white font-bold rounded-md hover:bg-blue-700 disabled:bg-blue-400 flex items-center justify-center">
                                    {isLoading ? <div className="loader"></div> : 'Buat Detail Prompt dengan AI'}
                                </button>
                                </>
                            ) : (
                                // --- HISTORY VIEW ---
                                <div className="overflow-y-auto custom-scrollbar pr-2 flex-grow">
                                    {history.length > 0 ? history.sort((a, b) => b.isFavorite - a.isFavorite).map(item => (
                                        <div key={item.id} className={`border p-3 mb-3 rounded-lg flex items-start gap-3 ${item.isFavorite ? 'bg-yellow-50' : ''}`}>
                                            <button onClick={() => toggleFavorite(item.id)} className="mt-1">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill={item.isFavorite ? '#f59e0b' : '#9ca3af'} viewBox="0 0 16 16">
                                                    <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                                </svg>
                                            </button>
                                            <div className="flex-grow">
                                                <p className="font-semibold">{item.inputs.productName || item.inputs.packagingProduct || item.inputs.greetingType || item.inputs.socialTopic || item.inputs.foodName || item.inputs.buildingType || item.inputs.characterSubject || "Tanpa Judul"}</p>
                                                <p className="text-xs text-gray-500">{new Date(item.id).toLocaleString()}</p>
                                                <button onClick={() => loadFromHistory(item)} className="text-sm text-blue-600 mt-2">Muat Ulang</button>
                                            </div>
                                        </div>
                                    )) : <p>Belum ada riwayat.</p>}
                                </div>
                            )}
                        </div>

                        {/* --- RIGHT PANEL --- */}
                        <div className="bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col">
                            <h2 className="text-xl font-semibold text-white mb-4">Hasil & Pratinjau</h2>
                            <div className="flex border-b border-gray-700 mb-2">
                                <button onClick={() => setActiveTab('id')} className={`py-2 px-4 text-sm ${activeTab === 'id' ? 'text-white border-b-2 border-blue-500' : 'text-gray-400'}`}>Bahasa Indonesia</button>
                                <button onClick={() => setActiveTab('en')} className={`py-2 px-4 text-sm ${activeTab === 'en' ? 'text-white border-b-2 border-blue-500' : 'text-gray-400'}`}>English</button>
                                <button onClick={() => setActiveTab('preview')} className={`py-2 px-4 text-sm ${activeTab === 'preview' ? 'text-white border-b-2 border-blue-500' : 'text-gray-400'}`}>Pratinjau Visual</button>
                            </div>
                            <div className="flex-grow flex flex-col bg-gray-900 rounded-md p-2">
                                {activeTab === 'id' && <textarea readOnly value={generatedPromptId} placeholder="Hasil prompt Bahasa Indonesia akan muncul di sini..." className="w-full flex-grow bg-transparent text-gray-300 p-2 custom-scrollbar whitespace-pre-wrap outline-none"></textarea>}
                                {activeTab === 'en' && <textarea readOnly value={generatedPromptEn} placeholder="Hasil prompt Bahasa Inggris akan muncul di sini..." className="w-full flex-grow bg-transparent text-gray-300 p-2 custom-scrollbar whitespace-pre-wrap outline-none"></textarea>}
                                {activeTab === 'preview' && (
                                    <div className="w-full flex-grow flex items-center justify-center">
                                        {isGeneratingImage ? <div className="loader"></div> : 
                                            previewImageUrl ? <img src={previewImageUrl} className="max-w-full max-h-full object-contain rounded-md" /> : <p className="text-gray-500">Buat pratinjau gambar setelah prompt dibuat.</p>
                                        }
                                    </div>
                                )}
                            </div>
                            <div className="mt-4 flex flex-col sm:flex-row gap-2">
                                {generatedPromptId && !isLoading && (
                                    <>
                                    <button onClick={() => copyToClipboard(activeTab === 'id' ? generatedPromptId : generatedPromptEn)} className="flex-1 py-2 bg-green-500 text-white font-semibold rounded-md hover:bg-green-600">
                                        {copySuccess || `Salin Teks`}
                                    </button>
                                    <button onClick={() => saveToFile(activeTab === 'id' ? generatedPromptId : generatedPromptEn)} className="flex-1 py-2 bg-gray-500 text-white font-semibold rounded-md hover:bg-gray-600">
                                        Simpan ke File
                                    </button>
                                    <button onClick={generateImagePreview} disabled={isGeneratingImage || outputType === 'video'} className="flex-1 py-2 bg-purple-600 text-white font-semibold rounded-md hover:bg-purple-700 disabled:bg-purple-400 disabled:cursor-not-allowed flex items-center justify-center">
                                        {isGeneratingImage ? <div className="loader"></div> : 'Pratinjau Gambar'}
                                    </button>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                    {/* --- HELP MODAL --- */}
                    {isHelpModalOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg shadow-xl p-6 max-w-lg w-full">
                                <h3 className="text-xl font-bold mb-4">Cara Mendapatkan API Key</h3>
                                <div className="space-y-4">
                                    <h4 className="font-semibold text-gray-800">Untuk Google Gemini & Imagen:</h4>
                                    <ol className="list-decimal list-inside space-y-1 text-gray-700 mt-1">
                                        <li>Buka situs **Google AI Studio**.</li>
                                        <li>Login dengan akun Google Anda.</li>
                                        <li>Klik tombol **"Get API key"** di menu sebelah kiri.</li>
                                        <li>Klik **"Create API key in new project"**.</li>
                                        <li>Salin (Copy) API Key yang muncul. Pastikan API ini diaktifkan untuk "Generative Language API" dan "Vertex AI API" (untuk Imagen).</li>
                                    </ol>
                                </div>
                                <button onClick={() => setIsHelpModalOpen(false)} className="mt-6 w-full bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600 transition-colors">Mengerti</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
